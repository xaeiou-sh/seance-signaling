# Caddy reverse proxy for Seance backend
# Configured via environment variables set in devenv.nix

{
	admin off
	auto_https off
}

# Backend domain (set by CADDY_DOMAIN env var)
{$CADDY_DOMAIN} {
	handle_path /signaling* {
		reverse_proxy localhost:4444 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
		}
	}
	handle {
		reverse_proxy localhost:3000 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
		}
	}
	log {
		output stderr
		format console
	}
}

# App domain (set by APP_DOMAIN env var)
{$APP_DOMAIN} {
	reverse_proxy localhost:3000 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
	}
	log {
		output stderr
		format console
	}
}
